# ld-decode Test Generation Scripts

This directory contains scripts for generating and managing ld-decode test files.

## Scripts

### generate_test_decodes.sh

Generates randomized ld-decode test commands from the master disc lists.

**Usage:**
```bash
./generate_test_decodes.sh
```

**What it does:**
- Reads from master lists: `ntsc-cav-master.txt`, `ntsc-clv-master.txt`, `pal-cav-master.txt`, `pal-clv-master.txt`
- Creates `decode_commands.sh` with ~170 randomized decode commands
- Samples from start/middle/end positions of each disc
- Generates more samples from CLV discs (fewer total discs available)

**Output:**
- File: `decode_commands.sh` (created in this directory)
- NTSC CAV: 1-2 decodes per disc, 48-58 frames each
- NTSC CLV: 5-6 decodes per disc, 48-58 frames each
- PAL CAV: 1-2 decodes per disc, 30-40 frames each
- PAL CLV: 4-5 decodes per disc, 30-40 frames each

### decode_commands.sh

Executes all ld-decode test file generation (auto-generated by `generate_test_decodes.sh`).

**Usage:**
```bash
./decode_commands.sh
```

**What it does:**
- Activates the ld-decode Python virtual environment
- Runs ~170 ld-decode commands
- Creates test files in `../../ld-decode/ntsc/cav`, `../../ld-decode/ntsc/clv`, `../../ld-decode/pal/cav`, `../../ld-decode/pal/clv`
- Generates `.tbc`, `.tbc.json`, and potentially `.efm`, `.log`, `.pcm`, `.tbc.db` files

**Note:** This file is regenerated each time you run `generate_test_decodes.sh`, so the decode positions will be randomized.

### clean_test_files.sh

Removes all generated test files from the ld-decode output directories.

**Usage:**
```bash
./clean_test_files.sh
```

**What it does:**
- Deletes all test files from:
  - `../../ld-decode/ntsc/cav/`
  - `../../ld-decode/ntsc/clv/`
  - `../../ld-decode/pal/cav/`
  - `../../ld-decode/pal/clv/`
- Removes file types: `.tbc`, `.tbc.json`, `.efm`, `.log`, `.pcm`, `.tbc.db`
- Reports count of removed files

**Use this before regenerating test files to ensure a clean slate.**

## Master Lists

The master lists contain source disc information with valid frame ranges:

- **ntsc-cav-master.txt** - 15 NTSC CAV discs
- **ntsc-clv-master.txt** - 4 NTSC CLV discs
- **pal-cav-master.txt** - 45 PAL CAV discs
- **pal-clv-master.txt** - 13 PAL CLV discs

Each entry contains:
```
filepath: VBI start - end | File pos start - end
```

## Typical Workflow

1. **Clean previous test files** (optional):
   ```bash
   ./clean_test_files.sh
   ```

2. **Generate new decode commands** (creates randomized positions):
   ```bash
   ./generate_test_decodes.sh
   ```

3. **Execute the decodes**:
   ```bash
   ./decode_commands.sh
   ```

4. **Run your tests** against the generated files in `../../ld-decode/`

## Requirements

- ld-decode installed in Python virtual environment
- Virtual environment path: `~/Coding/github/ld-decode-venv`
- Access to source `.ldf` files listed in master lists
- ~50MB disk space per test file (varies by format and frame count)
