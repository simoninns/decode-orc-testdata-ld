# ld-decode Test Generation Scripts

This directory contains scripts for generating and managing ld-decode test files.

## Overview

The test data repository contains **20 .ldf files** representing diverse content types across all LaserDisc formats. These files are generated using ld-decode's `--write-test-ldf` flag, which extracts only the specific frame ranges needed for testing without creating full decode outputs.

## Scripts

### generate_test_decodes.sh

Generates ld-decode commands to create test .ldf snippet files from 20 selected discs.

**Usage:**
```bash
./generate_test_decodes.sh
```

**What it does:**
- Reads from master lists: `ntsc-cav-master.txt`, `ntsc-clv-master.txt`, `pal-cav-master.txt`, `pal-clv-master.txt`
- Filters to **20 diverse, unique discs** (no duplicate discs/sides)
- Creates `decode_commands.sh` with 20 randomized decode commands
- Samples from start/middle/end positions of each disc
- Uses `--write-test-ldf` to create .ldf snippets without full decode outputs

**Selected Disc Distribution:**
- **5 NTSC CAV discs**: Calibration (Pioneer GGV1069), arcade games (Dragon's Lair DS1, Firefox), educational (National Gallery of Art), audio calibration (CheckingDolbySurround)
- **2 NTSC CLV discs**: Movies (Bambi, Cinderella)
- **6 PAL CAV discs**: Calibration (GGV1011), nature documentaries (British Garden Birds), educational (EcoDisc), entertainment (Roger Rabbit), historical data (Domesday), cultural content (City-Disc)
- **7 PAL CLV discs**: Multiple Domesday Project discs with variant types (PP/NP/AK), educational content (Images of 80s)

**Output:**
- File: `decode_commands.sh` (created in this directory)
- NTSC CAV: 48-58 frames each
- NTSC CLV: 48-58 frames each
- PAL CAV: 30-40 frames each
- PAL CLV: 30-40 frames each

### decode_commands.sh

Executes all .ldf snippet generation (auto-generated by `generate_test_decodes.sh`).

**Usage:**
```bash
./decode_commands.sh
```

**What it does:**
- Activates the ld-decode Python virtual environment
- Runs 20 ld-decode commands with `--write-test-ldf`
- Creates .ldf snippet files in `../../ld-decode/ntsc/cav`, `../../ld-decode/ntsc/clv`, `../../ld-decode/pal/cav`, `../../ld-decode/pal/clv`
- Automatically removes temporary `.tbc` and `.tbc.json` files after each decode
- Only keeps the final .ldf snippet files (typically 50-80MB each)

**Note:** This file is regenerated each time you run `generate_test_decodes.sh`, so the decode positions will be randomized.

### clean_test_files.sh

Removes all generated test files from the ld-decode output directories.

**Usage:**
```bash
./clean_test_files.sh
```

**What it does:**
- Deletes all test files from:
  - `../../ld-decode/ntsc/cav/`
  - `../../ld-decode/ntsc/clv/`
  - `../../ld-decode/pal/cav/`
  - `../../ld-decode/pal/clv/`
- Removes file types: `.tbc`, `.tbc.json`, `.efm`, `.log`, `.pcm`, `.tbc.db`
- Reports count of removed files

**Use this before regenerating test files to ensure a clean slate.**

## Master Lists

The master lists contain source disc information with valid frame ranges:

- **ntsc-cav-master.txt** - 15 NTSC CAV discs
- **ntsc-clv-master.txt** - 4 NTSC CLV discs
- **pal-cav-master.txt** - 45 PAL CAV discs
- **pal-clv-master.txt** - 13 PAL CLV discs

Each entry contains:
```
filepath: VBI start - end | File pos start - end
```

## Typical Workflow

1. **Clean previous test files** (optional):
   ```bash
   ./clean_test_files.sh
   ```

2. **Generate new decode commands** (creates randomized positions):
   ```bash
   ./generate_test_decodes.sh
   ```

3. **Execute the decodes**:
   ```bash
   ./decode_commands.sh
   ```

4. **Run your tests** against the generated files in `../../ld-decode/`

## Requirements

- ld-decode installed in Python virtual environment
- Virtual environment path: `~/Coding/github/ld-decode-venv`
- Access to source `.ldf` files listed in master lists
- ~50MB disk space per test file (varies by format and frame count)
